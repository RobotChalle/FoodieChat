{"ast":null,"code":"import React,{useState,useEffect}from'react';import axios from'axios';import NavBar from'./NavBar';import CalendarView from'./CalendarView';import TableView from'./TableView';import'./css/usermealsearch.css';import'./css/main.css';import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";export default function UserMealSearch(){const[query,setQuery]=useState('');const[meals,setMeals]=useState([]);const[responseType,setResponseType]=useState('table');const[filteredMeals,setFilteredMeals]=useState([]);const[loading,setLoading]=useState(false);const[chatHistory,setChatHistory]=useState([]);useEffect(()=>{axios.get('http://localhost:8080/users/meals',{withCredentials:true}).then(res=>setMeals(res.data)).catch(err=>console.error('ÏãùÎã® Ï°∞Ìöå Ïã§Ìå®:',err));},[]);const handleSubmit=async()=>{if(!query.trim())return;const userMessage={role:'user',content:query};setChatHistory(prev=>[...prev,userMessage]);setLoading(true);try{const res=await axios.post('http://localhost:8000/query',{query,meals},{headers:{'Content-Type':'application/json'},withCredentials:true});const result=res.data;setResponseType(result.type);setFilteredMeals(result.filteredMeals);const aiMessage={role:'ai',content:result.type==='table'?'üìã ÏãùÎã®ÏùÑ ÌÖåÏù¥Î∏î ÌòïÏãùÏúºÎ°ú Î≥¥Ïó¨ÎìúÎ¶¥Í≤åÏöî.':'üìÖ ÏãùÎã®ÏùÑ Îã¨Î†• ÌòïÏãùÏúºÎ°ú Î≥¥Ïó¨ÎìúÎ¶¥Í≤åÏöî.'};setChatHistory(prev=>[...prev,aiMessage]);}catch(error){var _error$response;const errorMessage={role:'ai',content:'‚ùå Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.'};setChatHistory(prev=>[...prev,errorMessage]);console.error('LLM ÏøºÎ¶¨ Ïã§Ìå®:',error);if(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===429){alert(\"OpenAI ÏÇ¨Ïö©ÎüâÏù¥ Ï¥àÍ≥ºÎêòÏóàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥ Ï£ºÏÑ∏Ïöî.\");}else{alert(\"ÏöîÏ≤≠ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.\");}}finally{setQuery('');setLoading(false);}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(NavBar,{}),/*#__PURE__*/_jsx(\"div\",{className:\"usermealsearch-wrapper\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"usermealsearch-inner\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"chat-feature-panel\",children:/*#__PURE__*/_jsx(\"div\",{className:\"visualizer\",children:loading?/*#__PURE__*/_jsx(\"div\",{className:\"loading-message\",children:\"\\u23F3 \\uBD84\\uC11D \\uC911\\uC785\\uB2C8\\uB2E4...\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[responseType==='table'&&/*#__PURE__*/_jsx(TableView,{meals:filteredMeals}),responseType==='calendar'&&/*#__PURE__*/_jsx(CalendarView,{meals:filteredMeals})]})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"chatbot-panel\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-title-bar\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"chat-icon\",children:\"\\uD83D\\uDCAC\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"chat-title\",children:\"\\uCC57\\uBD07\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"chat-history\",children:chatHistory.map((msg,idx)=>/*#__PURE__*/_jsx(\"div\",{className:`chat-message ${msg.role}`,children:/*#__PURE__*/_jsx(\"div\",{className:\"chat-bubble\",children:msg.content})},idx))}),/*#__PURE__*/_jsxs(\"div\",{className:\"chatbot-input-area\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:query,onChange:e=>setQuery(e.target.value),placeholder:\"\\uC608: 3\\uC6D4 \\uC2DD\\uB2E8\\uC744 \\uB2EC\\uB825\\uC73C\\uB85C \\uBCF4\\uC5EC\\uC918\",onKeyDown:e=>e.key==='Enter'&&handleSubmit()}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSubmit,disabled:loading,children:loading?'Ï†ÑÏÜ° Ï§ë...':'Ï†ÑÏÜ°'})]})]})]})})]});}","map":{"version":3,"names":["React","useState","useEffect","axios","NavBar","CalendarView","TableView","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","UserMealSearch","query","setQuery","meals","setMeals","responseType","setResponseType","filteredMeals","setFilteredMeals","loading","setLoading","chatHistory","setChatHistory","get","withCredentials","then","res","data","catch","err","console","error","handleSubmit","trim","userMessage","role","content","prev","post","headers","result","type","aiMessage","_error$response","errorMessage","response","status","alert","children","className","map","msg","idx","value","onChange","e","target","placeholder","onKeyDown","key","onClick","disabled"],"sources":["D:/workspace/FoodyChat/foodychat_frontend/src/components/UserMealSearch.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport NavBar from './NavBar';\r\nimport CalendarView from './CalendarView';\r\nimport TableView from './TableView';\r\nimport './css/usermealsearch.css';\r\nimport './css/main.css';\r\n\r\nexport default function UserMealSearch() {\r\n  const [query, setQuery] = useState('');\r\n  const [meals, setMeals] = useState([]);\r\n  const [responseType, setResponseType] = useState('table');\r\n  const [filteredMeals, setFilteredMeals] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [chatHistory, setChatHistory] = useState([]);\r\n\r\n  useEffect(() => {\r\n    axios.get('http://localhost:8080/users/meals', { withCredentials: true })\r\n      .then(res => setMeals(res.data))\r\n      .catch(err => console.error('ÏãùÎã® Ï°∞Ìöå Ïã§Ìå®:', err));\r\n  }, []);\r\n\r\n  const handleSubmit = async () => {\r\n    if (!query.trim()) return;\r\n\r\n    const userMessage = { role: 'user', content: query };\r\n    setChatHistory(prev => [...prev, userMessage]);\r\n\r\n    setLoading(true);\r\n    try {\r\n      const res = await axios.post('http://localhost:8000/query', {\r\n        query,\r\n        meals\r\n      }, {\r\n        headers: { 'Content-Type': 'application/json' },\r\n        withCredentials: true\r\n      });\r\n\r\n      const result = res.data;\r\n      setResponseType(result.type);\r\n      setFilteredMeals(result.filteredMeals);\r\n\r\n      const aiMessage = {\r\n        role: 'ai',\r\n        content: result.type === 'table'\r\n          ? 'üìã ÏãùÎã®ÏùÑ ÌÖåÏù¥Î∏î ÌòïÏãùÏúºÎ°ú Î≥¥Ïó¨ÎìúÎ¶¥Í≤åÏöî.'\r\n          : 'üìÖ ÏãùÎã®ÏùÑ Îã¨Î†• ÌòïÏãùÏúºÎ°ú Î≥¥Ïó¨ÎìúÎ¶¥Í≤åÏöî.'\r\n      };\r\n      setChatHistory(prev => [...prev, aiMessage]);\r\n    } catch (error) {\r\n      const errorMessage = {\r\n        role: 'ai',\r\n        content: '‚ùå Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.'\r\n      };\r\n      setChatHistory(prev => [...prev, errorMessage]);\r\n      console.error('LLM ÏøºÎ¶¨ Ïã§Ìå®:', error);\r\n\r\n      if (error.response?.status === 429) {\r\n        alert(\"OpenAI ÏÇ¨Ïö©ÎüâÏù¥ Ï¥àÍ≥ºÎêòÏóàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥ Ï£ºÏÑ∏Ïöî.\");\r\n      } else {\r\n        alert(\"ÏöîÏ≤≠ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.\");\r\n      }\r\n    } finally {\r\n      setQuery('');\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <NavBar />\r\n      <div className=\"usermealsearch-wrapper\">\r\n        <div className=\"usermealsearch-inner\">\r\n          <div className=\"chat-feature-panel\">\r\n            <div className=\"visualizer\">\r\n              {loading ? (\r\n                <div className=\"loading-message\">‚è≥ Î∂ÑÏÑù Ï§ëÏûÖÎãàÎã§...</div>\r\n              ) : (\r\n                <>\r\n                  {responseType === 'table' && <TableView meals={filteredMeals} />}\r\n                  {responseType === 'calendar' && <CalendarView meals={filteredMeals} />}\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"chatbot-panel\">\r\n            <div className=\"chat-title-bar\">\r\n              <span className=\"chat-icon\">üí¨</span>\r\n              <h3 className=\"chat-title\">Ï±óÎ¥á</h3>\r\n            </div>\r\n\r\n            <div className=\"chat-history\">\r\n              {chatHistory.map((msg, idx) => (\r\n                <div key={idx} className={`chat-message ${msg.role}`}>\r\n                  <div className=\"chat-bubble\">\r\n                    {msg.content}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n\r\n            <div className=\"chatbot-input-area\">\r\n              <input\r\n                type=\"text\"\r\n                value={query}\r\n                onChange={e => setQuery(e.target.value)}\r\n                placeholder=\"Ïòà: 3Ïõî ÏãùÎã®ÏùÑ Îã¨Î†•ÏúºÎ°ú Î≥¥Ïó¨Ï§ò\"\r\n                onKeyDown={(e) => e.key === 'Enter' && handleSubmit()}\r\n              />\r\n              <button onClick={handleSubmit} disabled={loading}>\r\n                {loading ? 'Ï†ÑÏÜ° Ï§ë...' : 'Ï†ÑÏÜ°'}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}