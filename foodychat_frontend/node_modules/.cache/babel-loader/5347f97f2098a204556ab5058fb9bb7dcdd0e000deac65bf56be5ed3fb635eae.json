{"ast":null,"code":"import{useEffect,useState,useRef}from\"react\";import axios from\"axios\";import{Link}from\"react-router-dom\";import NavBar from'./NavBar';import'./css/chatbot.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function ChatBot(){const[userId,setUserId]=useState(null);const[question,setQuestion]=useState(\"\");const[chatHistory,setChatHistory]=useState([]);const[loading,setLoading]=useState(false);const textareaRef=useRef(null);const chatRef=useRef(null);useEffect(()=>{axios.get(\"http://localhost:8080/users/user-id\",{withCredentials:true}).then(res=>setUserId(res.data)).catch(err=>{console.error(\"‚ùå Ïú†Ï†Ä Ï†ïÎ≥¥ Î°úÎî© Ïã§Ìå®\",err);});},[]);useEffect(()=>{if(chatRef.current){chatRef.current.scrollTop=chatRef.current.scrollHeight;}},[chatHistory]);const handleSend=async()=>{if(!question.trim())return;if(!userId){setChatHistory(prev=>[...prev,{role:\"bot\",text:\"‚ùó Î°úÍ∑∏Ïù∏Ìïú Ïú†Ï†ÄÎßå ÏßàÎ¨∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.\"}]);return;}const userText=question;setQuestion(\"\");autoResize();setChatHistory(prev=>[...prev,{role:\"user\",text:userText},{role:\"bot\",text:\"üí¨ ÏÉùÍ∞Å Ï§ë...\",loading:true}]);setLoading(true);try{const res=await axios.post(\"http://localhost:8000/chat/chat\",{user_id:userId,question:userText});setChatHistory(prev=>{const updated=prev.filter(msg=>!msg.loading);return[...updated,{role:\"bot\",text:res.data.answer}];});}catch(err){setChatHistory(prev=>{var _err$response,_err$response$data;const updated=prev.filter(msg=>!msg.loading);return[...updated,{role:\"bot\",text:`‚ö†Ô∏è ÏÑúÎ≤Ñ Ïò§Î•ò: ${((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.detail)||err.message}`}];});}finally{setLoading(false);}};const autoResize=()=>{const el=textareaRef.current;if(el){el.style.height=\"auto\";el.style.height=`${Math.min(el.scrollHeight,160)}px`;}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(NavBar,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"chat-header\",children:/*#__PURE__*/_jsxs(Link,{to:\"/\",className:\"logo\",children:[\"\\uD83C\\uDF7D \",/*#__PURE__*/_jsx(\"span\",{children:\"FoodyChat\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"chat-window\",ref:chatRef,children:chatHistory.map((msg,idx)=>/*#__PURE__*/_jsx(\"div\",{className:`chat-bubble ${msg.role}`,children:msg.role==='bot'?msg.text.split('---').map((block,bIdx)=>/*#__PURE__*/_jsxs(\"div\",{className:\"chat-block\",children:[bIdx!==0&&/*#__PURE__*/_jsx(\"hr\",{className:\"chat-divider\"}),/*#__PURE__*/_jsx(\"div\",{children:block.trim()})]},bIdx)):msg.text},idx))}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-input-box\",children:[/*#__PURE__*/_jsx(\"textarea\",{ref:textareaRef,value:question,onChange:e=>{setQuestion(e.target.value);autoResize();},onKeyDown:e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();handleSend();}},placeholder:\"\\uBA54\\uC2DC\\uC9C0\\uB97C \\uC785\\uB825\\uD558\\uC138\\uC694\",rows:\"1\",className:\"chat-textarea\"}),/*#__PURE__*/_jsx(\"button\",{className:\"chat-send-btn\",onClick:handleSend,disabled:loading,children:loading?\"Ï†ÑÏÜ° Ï§ë...\":\"Î≥¥ÎÇ¥Í∏∞\"})]})]})]});}export default ChatBot;","map":{"version":3,"names":["useEffect","useState","useRef","axios","Link","NavBar","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ChatBot","userId","setUserId","question","setQuestion","chatHistory","setChatHistory","loading","setLoading","textareaRef","chatRef","get","withCredentials","then","res","data","catch","err","console","error","current","scrollTop","scrollHeight","handleSend","trim","prev","role","text","userText","autoResize","post","user_id","updated","filter","msg","answer","_err$response","_err$response$data","response","detail","message","el","style","height","Math","min","children","className","to","ref","map","idx","split","block","bIdx","value","onChange","e","target","onKeyDown","key","shiftKey","preventDefault","placeholder","rows","onClick","disabled"],"sources":["D:/workspace/FoodyChat/foodychat_frontend/src/components/ChatBot.js"],"sourcesContent":["import { useEffect, useState, useRef } from \"react\";\r\nimport axios from \"axios\";\r\nimport { Link } from \"react-router-dom\";\r\nimport NavBar from './NavBar';\r\nimport './css/chatbot.css';\r\n\r\nfunction ChatBot() {\r\n  const [userId, setUserId] = useState(null);\r\n  const [question, setQuestion] = useState(\"\");\r\n  const [chatHistory, setChatHistory] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const textareaRef = useRef(null);\r\n  const chatRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    axios.get(\"http://localhost:8080/users/user-id\", { withCredentials: true })\r\n      .then(res => setUserId(res.data))\r\n      .catch(err => {\r\n        console.error(\"‚ùå Ïú†Ï†Ä Ï†ïÎ≥¥ Î°úÎî© Ïã§Ìå®\", err);\r\n      });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (chatRef.current) {\r\n      chatRef.current.scrollTop = chatRef.current.scrollHeight;\r\n    }\r\n  }, [chatHistory]);\r\n\r\n  const handleSend = async () => {\r\n    if (!question.trim()) return;\r\n    if (!userId) {\r\n      setChatHistory(prev => [...prev, { role: \"bot\", text: \"‚ùó Î°úÍ∑∏Ïù∏Ìïú Ïú†Ï†ÄÎßå ÏßàÎ¨∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.\" }]);\r\n      return;\r\n    }\r\n\r\n    const userText = question;\r\n    setQuestion(\"\");\r\n    autoResize();\r\n    setChatHistory(prev => [\r\n      ...prev,\r\n      { role: \"user\", text: userText },\r\n      { role: \"bot\", text: \"üí¨ ÏÉùÍ∞Å Ï§ë...\", loading: true }\r\n    ]);\r\n    setLoading(true);\r\n\r\n    try {\r\n      const res = await axios.post(\"http://localhost:8000/chat/chat\", {\r\n        user_id: userId,\r\n        question: userText,\r\n      });\r\n\r\n      setChatHistory(prev => {\r\n        const updated = prev.filter(msg => !msg.loading);\r\n        return [...updated, { role: \"bot\", text: res.data.answer }];\r\n      });\r\n    } catch (err) {\r\n      setChatHistory(prev => {\r\n        const updated = prev.filter(msg => !msg.loading);\r\n        return [...updated, {\r\n          role: \"bot\",\r\n          text: `‚ö†Ô∏è ÏÑúÎ≤Ñ Ïò§Î•ò: ${err.response?.data?.detail || err.message}`\r\n        }];\r\n      });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const autoResize = () => {\r\n    const el = textareaRef.current;\r\n    if (el) {\r\n      el.style.height = \"auto\";\r\n      el.style.height = `${Math.min(el.scrollHeight, 160)}px`;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <NavBar />\r\n      <div className=\"chat-container\">\r\n        <div className=\"chat-header\">\r\n          <Link to=\"/\" className=\"logo\">\r\n            üçΩ <span>FoodyChat</span>\r\n          </Link>\r\n        </div>\r\n\r\n        <div className=\"chat-window\" ref={chatRef}>\r\n          {chatHistory.map((msg, idx) => (\r\n            <div key={idx} className={`chat-bubble ${msg.role}`}>\r\n              {msg.role === 'bot'\r\n                ? msg.text.split('---').map((block, bIdx) => (\r\n                    <div key={bIdx} className=\"chat-block\">\r\n                      {bIdx !== 0 && <hr className=\"chat-divider\" />}\r\n                      <div>{block.trim()}</div>\r\n                    </div>\r\n                  ))\r\n                : msg.text}\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        <div className=\"chat-input-box\">\r\n          <textarea\r\n            ref={textareaRef}\r\n            value={question}\r\n            onChange={(e) => {\r\n              setQuestion(e.target.value);\r\n              autoResize();\r\n            }}\r\n            onKeyDown={(e) => {\r\n              if (e.key === 'Enter' && !e.shiftKey) {\r\n                e.preventDefault();\r\n                handleSend();\r\n              }\r\n            }}\r\n            placeholder=\"Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî\"\r\n            rows=\"1\"\r\n            className=\"chat-textarea\"\r\n          />\r\n          <button className=\"chat-send-btn\" onClick={handleSend} disabled={loading}>\r\n            {loading ? \"Ï†ÑÏÜ° Ï§ë...\" : \"Î≥¥ÎÇ¥Í∏∞\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default ChatBot;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}